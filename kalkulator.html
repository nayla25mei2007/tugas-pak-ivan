<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator Sederhana</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c3aed;
      --muted:#94a3b8;
      --btn:#111827;
      --btn-hover:#152033;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #071021 0%, #071422 100%);
      color:#e6eef8;
      display:flex;align-items:center;justify-content:center;padding:24px;
    }

    .card{
      width:340px;
      max-width:96vw;
      border-radius:16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 6px 30px rgba(2,6,23,0.8);
      padding:18px;
    }

    .title{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .logo{
      width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#334155);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px;box-shadow:0 6px 18px rgba(124,58,237,0.18)
    }
    h1{font-size:16px;margin:0}
    p{margin:0;color:var(--muted);font-size:12px}

    .display{
      margin-top:12px;padding:12px;border-radius:12px;background:var(--glass);min-height:64px;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;
      gap:6px;word-break:break-all;overflow:hidden
    }
    .expression{color:var(--muted);font-size:14px;max-width:100%;}
    .result{font-size:24px;font-weight:600}

    .pad{margin-top:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button{
      appearance:none;border:0;padding:14px;border-radius:10px;background:var(--btn);color:inherit;font-size:16px;cursor:pointer;box-shadow:inset 0 -2px 0 rgba(0,0,0,0.35);
    }
    button:active{transform:translateY(1px)}
    button.operator{background:linear-gradient(180deg,var(--accent),#5b21b6);box-shadow:0 8px 20px rgba(124,58,237,0.18);}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    button.wide{grid-column:span 2}

    .help{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    /* focus styles for accessibility */
    button:focus{outline:3px solid rgba(124,58,237,0.18);outline-offset:2px}

    @media (max-width:380px){.card{width:320px}}
  </style>
</head>
<body>
  <main class="card" role="application" aria-label="Kalkulator Sederhana">
    <div class="title">
      <div class="logo">K</div>
      <div>
        <h1>Kalkulator Sederhana</h1>
        <p>Operasi: + − × ÷ · tombol keyboard didukung</p>
      </div>
    </div>

    <div class="display" id="display" aria-live="polite">
      <div class="expression" id="expression">&nbsp;</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="pad" role="group" aria-label="Tombol kalkulator">
      <button class="secondary" data-action="clear" aria-label="Clear (C)">C</button>
      <button class="secondary" data-action="back" aria-label="Backspace">⌫</button>
      <button class="secondary" data-value="%" aria-label="Persen">%</button>
      <button class="operator" data-value="/" aria-label="Bagi">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="operator" data-value="*" aria-label="Kali">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="operator" data-value="-" aria-label="Kurang">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="operator" data-value="+" aria-label="Tambah">+</button>

      <button data-value="0" class="wide">0</button>
      <button data-value="." aria-label="Desimal">.</button>
      <button class="operator" data-action="equals" aria-label="Sama dengan (=)">=</button>
    </div>

    <div class="help">Anda bisa pakai keyboard: angka, + - * /, Enter (=), Backspace, Esc (C)</div>
  </main>

  <script>
    (function(){
      const exprEl = document.getElementById('expression');
      const resultEl = document.getElementById('result');
      const pad = document.querySelector('.pad');

      let expression = '';

      function updateDisplay(){
        exprEl.textContent = expression || '\u00A0';
        resultEl.textContent = evaluatePreview(expression);
      }

      function sanitize(input){
        // only allow digits, operators, parentheses, dot and percent
        // replace unicode × ÷ with * /
        const cleaned = input.replace(/[×xX]/g,'*').replace(/[÷/]/g,'/');
        if (/[^0-9()+\-*/.%\s]/.test(cleaned)) return null;
        return cleaned;
      }

      function evaluatePreview(expr){
        const s = sanitize(expr);
        if (!s || s.trim()==='') return '0';
        try{
          // handle percent: convert numbers followed by % to (/100)
          const withPercent = s.replace(/(\d+(?:\.\d+)?)%/g,'($1/100)');
          // use Function as a safer eval substitute (still local)
          const val = Function('return (' + withPercent + ')')();
          if (val === undefined || Number.isNaN(val) || !isFinite(val)) return '';
          // show up to 12 significant digits
          return String(Math.round((val + Number.EPSILON) * 1e12) / 1e12);
        }catch(e){
          return '';
        }
      }

      function pressValue(v){
        if (v === null) return;
        expression += v;
        updateDisplay();
      }

      function doClear(){ expression = ''; updateDisplay(); }
      function doBack(){ expression = expression.slice(0,-1); updateDisplay(); }

      function doEquals(){
        const s = sanitize(expression);
        if (!s) return;
        try{
          const withPercent = s.replace(/(\d+(?:\.\d+)?)%/g,'($1/100)');
          const val = Function('return (' + withPercent + ')')();
          if (val === undefined || Number.isNaN(val) || !isFinite(val)){
            resultEl.textContent = 'Error';
            return;
          }
          expression = String(Math.round((val + Number.EPSILON) * 1e12) / 1e12);
          updateDisplay();
        }catch(e){ resultEl.textContent='Error'; }
      }

      pad.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if (!btn) return;
        const v = btn.dataset.value ?? null;
        const action = btn.dataset.action ?? null;
        if (action === 'clear') doClear();
        else if (action === 'back') doBack();
        else if (action === 'equals') doEquals();
        else if (v !== null) pressValue(v);
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if (e.key >= '0' && e.key <= '9') { pressValue(e.key); e.preventDefault(); }
        else if (['+','-','*','/','(',')','.'].includes(e.key)){ pressValue(e.key); e.preventDefault(); }
        else if (e.key === 'Enter'){ doEquals(); e.preventDefault(); }
        else if (e.key === 'Backspace'){ doBack(); e.preventDefault(); }
        else if (e.key === 'Escape'){ doClear(); e.preventDefault(); }
        else if (e.key === '%'){ pressValue('%'); e.preventDefault(); }
      });

      // initialize
      updateDisplay();

      // expose for debugging (optional)
      window._calc = { getExpression: ()=>expression };
    })();
  </script>
</body>
</html>
